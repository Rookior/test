<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>


    <input type="button" name="aa" value="跨域提交" onclick="send('bbb(666)')"/>
    <div id="main"></div>
    2222
    <script>
      console.log(111,window.a)
        if(!window.a){
          console.log(222,window.a)
function send(){   
  sendMessage(Math.random());
    }
    (function(win, doc){
      
      var ifr = win.parent;
      
      var cb = function(msg){
        console.log(msg)    
      };
      var sendMessage = function(){
        // if(win.postMessage){
        //   if (win.addEventListener) {
        //             win.addEventListener("message",function(e){
        //     cb.call(win,e.data);
        //   },false);
        //         }else if(win.attachEvent) {
        //             win.attachEvent("onmessage",function(e){    
        //               cb.call(win,e.data);
        // });
        //         }
        //   return function(data){
        //     ifr.postMessage(data,'*');
        //   };
        // }else{
          var hash = '';
          
          setInterval(function(){
            if(win.name!==hash){
              hash = win.name;
              console.log(666,"子组件不能postmessage是尝试调用自己方法",hash)
              cb.call(win,hash);
            }
          },200);
          return function(data){
            ifr.name = data;
          };
        // }
      }
      win.sendMessage = sendMessage();
      console.log(333,window.a)
        })(window, document);
        window.a=1;

        console.log(444,window.a)
}

function aaa(text){
    alert(text)
    document.getElementById("main").innerHTML  = '父向子通信' +  text
}

function bbb(){
  alert(6)
}
    </script>
</body>
</html>